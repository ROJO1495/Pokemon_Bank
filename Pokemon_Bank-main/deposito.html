<!DOCTYPE html>
<html lang="es">
  <head>
    <script src="js/storageManager.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/PantallasAcciones.css" />
    <title>Depósito - Pokémon Bank</title>
    <!-- Bootstrap 4 -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="atm-card">
      <!-- Encabezado -->
      <div class="header-bank">
        <h3>Pokémon Bank</h3>
        <p style="font-size: 1.1rem">Depósito</p>
      </div>
      <!-- Información de usuario -->
      <div class="d-flex justify-content-between align-items-center p-4 border rounded mb-4">
        <div style="font-size: 1.2rem">
            <strong id="userName">Cargando...</strong><br />
            <small style="font-size: 1rem"><b>Cuenta:</b> <span id="accountNumber">Cargando...</span></small>
        </div>
        <div>
            <span><b>Saldo Actual</b></span><br />
            <span class="saldo" id="currentBalance" style="font-size:1.5rem;">Cargando...</span>
        </div>
      </div>
      <!-- Formulario de Depósito -->
      <form>
        <div class="form-group">
          <label for="montoDeposito"><b>Monto a depositar</b></label>
          <input type="number" class="form-control" id="montoDeposito" placeholder="Ingrese el monto" min="1" required>
        </div>
        <div class="text-center mt-4">
          <button type="submit" class="btn btn-success">Depositar</button>
          <a href="PantallaAcciones.html" class="btn btn-primary ml-2">Volver</a>
        </div>
      </form>
    </div>
    <script>
    function loadUserData() {
        const userData = storageManager.getUserData();
        if (userData) {
            document.getElementById('userName').textContent = userData.nombre;
            document.getElementById('accountNumber').textContent = userData.cuenta;
            document.getElementById('currentBalance').textContent = 
                storageManager.formatCurrency(userData.saldoActual);
        }
    }

    // Manejar el depósito
    document.querySelector('form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const montoInput = document.getElementById('montoDeposito');
        const monto = parseFloat(montoInput.value);
        
        if (monto <= 0 || isNaN(monto)) {
            alert('Por favor ingrese un monto válido');
            return;
        }

        const userData = storageManager.getUserData();
        const nuevoSaldo = userData.saldoActual + monto;
        
        // Actualizar saldo
        if (storageManager.updateBalance(nuevoSaldo)) {
            // Registrar transacción
            storageManager.recordTransaction('deposito', 'Depósito en efectivo', monto, nuevoSaldo);
            
            alert(`Depósito de ${storageManager.formatCurrency(monto)} realizado exitosamente`);
            montoInput.value = '';
            
            // Actualizar saldo en pantalla
            document.getElementById('currentBalance').textContent = 
                storageManager.formatCurrency(nuevoSaldo);
                
            setTimeout(() => {
                window.location.href = 'PantallaAcciones.html';
            }, 2000);
        } else {
            alert('Error al realizar el depósito');
        }
    });

    document.addEventListener('DOMContentLoaded', loadUserData);
    </script>
    </body>
</html>