<!DOCTYPE html>
<html lang="es">
<head>
    <script src="js/storageManager.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/PantallasAcciones.css" />
    <title>Pantalla Principal - Pok√©mon Bank</title>

    <!-- Bootstrap 4 -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <!-- Pantalla Principal -->
    <div class="atm-card">
      <!-- Encabezado -->
      <div class="header-bank">
        <h3>Pok√©mon Bank</h3>
        <p style="font-size: 1.1rem">Bienvenido/a</p>
      </div>

      <!-- Informaci√≥n de usuario -->
      <div
        class="d-flex justify-content-between align-items-center p-4 border rounded mb-4"
      >
        <div style="font-size: 1.2rem">
          <strong id="userName">Ash Ketchum</strong><br />
          <small style="font-size: 1rem"> <b>Cuenta:</b> <span id="accountNumber">0987654321</span> </small>
        </div>
        <div>
          <span><b>Saldo Inicial</b></span
          ><br />
          <span class="saldo" id="initialBalance">$500.00</span>
        </div>
      </div>

      <!-- Men√∫ de Transacciones -->
      <h4 class="text-center mb-4">Seleccione una Transacci√≥n</h4>
      <div class="row">
        <div class="col-md-6">
          <button class="btn btn-success btn-custom" id="btnDeposito">
            Dep√≥sito
          </button>
        </div>
        <div class="col-md-6">
          <button class="btn btn-success btn-custom" id="btnConsultarSaldo">
            Consultar Saldo
          </button>
        </div>
        <div class="col-md-6">
          <button class="btn btn-success btn-custom" id="btnRetiro">
            Retiro
          </button>
        </div>
        <div class="col-md-6">
          <button class="btn btn-success btn-custom" id="btnPagoServicios">
            Pago de Servicios
          </button>
        </div>
        <div class="col-md-6">
          <button class="btn btn-success btn-custom" id="btnHistorial">
            Historial de Transacciones
          </button>
        </div>
        <div class="col-md-6">
          <button class="btn btn-success btn-custom" id="btnAnalisisGrafico">
            An√°lisis Gr√°fico
          </button>
        </div>
      </div>
      <!-- Bot√≥n Salir -->
      <div class="text-center mt-4">
        <button class="btn btn-danger" id="btnSalir">Salir</button>
      </div>
    </div>

    <script>
        // ==========================================
        // GESTOR DE DATOS DEL USUARIO
        // ==========================================
        class UserDataManager {
            constructor() {
                this.storageKey = 'pokemonBankUser';
                this.transactionsKey = 'pokemonBankTransactions';
            }

            getUserData() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('Error al obtener datos:', error);
                    return null;
                }
            }

            saveUserData(userData) {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(userData));
                    return true;
                } catch (error) {
                    console.error('Error al guardar datos:', error);
                    return false;
                }
            }

            getTransactions() {
                try {
                    const data = localStorage.getItem(this.transactionsKey);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('Error al obtener transacciones:', error);
                    return [];
                }
            }

            recordTransaction(tipo, descripcion, monto, saldoResultante) {
                try {
                    const transactions = this.getTransactions();
                    const newTransaction = {
                        id: Date.now(),
                        fecha: new Date().toISOString(),
                        tipo: tipo,
                        descripcion: descripcion,
                        monto: monto,
                        saldoResultante: saldoResultante,
                        estado: 'completada'
                    };
                    transactions.push(newTransaction);
                    localStorage.setItem(this.transactionsKey, JSON.stringify(transactions));
                    return newTransaction;
                } catch (error) {
                    console.error('Error al registrar transacci√≥n:', error);
                    return null;
                }
            }
        }

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        const userManager = new UserDataManager();

        function loadUserInfo() {
            const userData = userManager.getUserData();
            
            if (!userData) {
                Swal.fire({
                    title: '‚ö†Ô∏è Sesi√≥n Expirada',
                    text: 'Por favor, inicia sesi√≥n nuevamente.',
                    icon: 'warning',
                    confirmButtonColor: '#667eea'
                }).then(() => {
                    window.location.href = 'login.html';
                });
                return;
            }

            // Mostrar informaci√≥n del usuario
            document.getElementById('userName').textContent = userData.nombre;
            document.getElementById('accountNumber').textContent = userData.cuenta;
            document.getElementById('initialBalance').textContent = `$${userData.saldoInicial.toFixed(2)}`;
        }

        // Botones de navegaci√≥n
        document.getElementById("btnDeposito").onclick = function () {
            window.location.href = "deposito.html";
        };

        document.getElementById("btnConsultarSaldo").onclick = function () {
            window.location.href = "consultaDeSaldo.html";
        };

        document.getElementById("btnRetiro").onclick = function () {
            window.location.href = "retiro.html";
        };

        document.getElementById("btnPagoServicios").onclick = function () {
            window.location.href = "pago-servicios.html";
        };

        document.getElementById("btnHistorial").onclick = function () {
            window.location.href = "historial.html";
        };

        document.getElementById("btnAnalisisGrafico").onclick = function () {
            window.location.href = "reportes.html";
        };

        // Bot√≥n Salir
        document.getElementById("btnSalir").addEventListener("click", () => {
            Swal.fire({
                title: "¬øDesea cerrar la sesi√≥n?",
                text: "Si cierra sesi√≥n tendr√° que ingresar de nuevo con su PIN.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "S√≠, salir",
                cancelButtonText: "Cancelar",
                reverseButtons: true,
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: "Sesi√≥n cerrada",
                        text: "Ha cerrado su sesi√≥n correctamente.",
                        icon: "success",
                        confirmButtonText: "Aceptar",
                    }).then(() => {
                        window.location.href = "login.html";
                    });
                }
            });
        });

        // Cargar informaci√≥n al iniciar
        window.addEventListener('DOMContentLoaded', loadUserInfo);

        console.log('‚úÖ Pantalla de Acciones inicializada');
        console.log('üìä Datos del usuario cargados desde LocalStorage');
    </script>
</body>
</html>